<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Atom Animation</title>
    <style>
        body { margin: 0; background: black; }
        svg { width: 100vw; height: 100vh; }
    </style>
</head>
<body>
    <svg id="animation" viewBox="-200 -200 400 400"></svg>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script>
        const svg = d3.select('#animation');

        // Ellipse parameters
        const a = 100;  // Semi-major axis
        const b = 50;   // Semi-minor axis
        const c = Math.sqrt(a * a - b * b);  // Distance from center to focus

        // Rotation angles and starting positions (in radians)
        const phi = [0, 2 * Math.PI / 3, 4 * Math.PI / 3];  // 0°, 120°, 240°
        const theta0 = [0, 2 * Math.PI / 3, 4 * Math.PI / 3];  // Staggered starting angles

        // Function to generate ellipse path data
        function generateEllipsePath(a, b, h, k, phi, thetaStart) {
            const points = [];
            const numPoints = 100;
            for (let i = 0; i <= numPoints; i++) {
                const theta = thetaStart + (i / numPoints) * 2 * Math.PI;
                const x = h + a * Math.cos(theta) * Math.cos(phi) - b * Math.sin(theta) * Math.sin(phi);
                const y = k + a * Math.cos(theta) * Math.sin(phi) + b * Math.sin(theta) * Math.cos(phi);
                points.push([x, y]);
            }
            return points.map((p, i) => (i === 0 ? 'M' : 'L') + p.join(',')).join(' ') + 'Z';
        }

        // Draw the nucleus
        svg.append('circle')
            .attr('cx', 0)
            .attr('cy', 0)
            .attr('r', 10)
            .attr('fill', 'blue');

        // Draw the elliptical paths and store their IDs
        const pathIds = phi.map((p, i) => {
            const h = -c * Math.cos(p);  // Shift center so nucleus is at focus
            const k = -c * Math.sin(p);
            const pathData = generateEllipsePath(a, b, h, k, p, theta0[i]);
            const pathId = `path${i}`;
            svg.append('path')
                .attr('d', pathData)
                .attr('stroke', 'white')
                .attr('stroke-width', 2)
                .attr('fill', 'none')
                .attr('id', pathId);
            return pathId;
        });

        // Draw and animate the electron dots
        const colors = ['green', 'yellow', 'pink'];
        colors.forEach((color, i) => {
            const dot = svg.append('circle')
                .attr('r', 5)
                .attr('fill', color);
            const animateMotion = dot.append('animateMotion')
                .attr('dur', '2s')  // Duration of one orbit
                .attr('repeatCount', 'indefinite');  // Loop forever
            animateMotion.append('mpath')
                .attr('xlink:href', `#${pathIds[i]}`);
        });
    </script>
</body>
</html>